{
  "title" : "Build Model",
  "sections" : [ {
    "viewMode" : "form",
    "name" : "Model",
    "model" : "BuildModel",
    "fields" : [ {
      "name" : "ModelName",
      "links" : [ {
        "page" : "BuildSection",
        "filter" : "SectionModel Equals '${ModelName}'"
      } ]
    }, {
      "name" : "ModelBasisTable",
      "selectModel" : "ListTables",
      "selectSourceField" : "TableName",
      "fieldType" : "select",
      "links" : [ {
        "page" : "BuildTable",
        "filter" : "TableName Equals '${ModelBasisTable}'"
      } ]
    }, {
      "name" : "ModelParentName",
      "label" : "Parent Model",
      "links" : [ {
        "page" : "BuildModel",
        "filter" : "ModelID Equals ${ModelParentID}"
      } ]
    }, {
      "name" : "ModelModule",
      "selectModel" : "ListModules",
      "selectSourceField" : "ModuleName"
    }, {
      "name" : "ModelLimit"
    }, {
      "name" : "ModelPreSave"
    }, {
      "name" : "ModelFilter"
    }, {
      "name" : "ModelExtends"
    }, {
      "name" : "ModelCustomUrlSource"
    }, {
      "name" : "ModelAllowInsert"
    }, {
      "name" : "ModelAllowUpdate"
    }, {
      "name" : "ModelAllowDelete"
    } ],
    "sections" : [ {
      "viewMode" : "form",
      "name" : "ModelSteps",
      "model" : "ModelSteps",
      "title" : "Steps",
      "fields" : [ {
        "name" : "ModelStepName",
        "label" : "Step Name",
        "showInNavigation" : true
      }, {
        "name" : "ModelStepJoin",
        "label" : "Table Join",
        "selectModel" : "ListTableJoins",
        "selectFilter" : "TableJoinFromTableName = '${ModelBasisTable}'",
        "selectSourceField" : "TableJoinName",
        "fieldType" : "select"
      }, {
        "name" : "ModelStepParentName",
        "label" : "Parent Step"
      } ]
    }, {
      "viewMode" : "form",
      "name" : "ModelFields",
      "model" : "ModelFields",
      "title" : "Fields",
      "fields" : [ {
        "name" : "ModelFieldBasisColumn",
        "selectModel" : "ListTableColumns",
        "selectFilter" : "ColumnTableName Equals '${ModelBasisTable}'",
        "selectSourceField" : "ColumnName",
        "fieldType" : "select"
      }, {
        "name" : "ModelFieldName",
        "label" : "Field Name",
        "showInNavigation" : true
      }, {
        "name" : "ModelFieldStepName",
        "selectTargetID" : "ModelFieldStepID",
        "selectModel" : "ListModelSteps",
        "selectFilter" : "ModelStepModelID Equals ${ModelID}",
        "selectSourceField" : "ModelStepName",
        "fieldType" : "select"
      }, {
        "name" : "ModelFieldRequired"
      }, {
        "name" : "ModelFieldUpdateable"
      }, {
        "name" : "ModelFieldExport"
      }, {
        "name" : "ModelFieldAlwaysDefault"
      }, {
        "name" : "ModelFieldFieldDefault"
      }, {
        "name" : "ModelFieldValueDefault"
      }, {
        "name" : "ModelFieldFunctionDefault"
      } ]
    }, {
      "viewMode" : "form",
      "name" : "ModelSort",
      "model" : "ModelSort",
      "title" : "Sorting",
      "fields" : [ {
        "name" : "ModelSortFieldName",
        "selectTargetID" : "ModelSortFieldID",
        "label" : "Field Name",
        "selectModel" : "ListModelFields",
        "selectFilter" : "FieldModelID Equals ${ModelID}",
        "selectSourceField" : "FieldName",
        "fieldType" : "select"
      }, {
        "name" : "ModelSortAscending"
      } ]
    }, {
      "viewMode" : "form",
      "name" : "ChildModel",
      "model" : "ChildModel",
      "title" : "Child Models",
      "fields" : [ {
        "name" : "ChildModelName",
        "showInNavigation" : true,
        "links" : [ {
          "page" : "BuildModel",
          "filter" : "ModelID Equals ${ChildModelID}"
        } ]
      }, {
        "name" : "ChildModelBasisTable",
        "selectModel" : "ListTables",
        "selectSourceField" : "TableName",
        "fieldType" : "select",
        "links" : [ {
          "page" : "BuildTable",
          "filter" : "TableName Equals '${ChildModelBasisTable}'"
        } ]
      }, {
        "name" : "ChildModelParentField",
        "selectModel" : "ListModelFields",
        "selectFilter" : "FieldModelID Equals ${ModelID}",
        "selectSourceField" : "FieldName",
        "fieldType" : "select"
      }, {
        "name" : "ChildModelChildField",
        "selectModel" : "ListModelFields",
        "selectFilter" : "FieldModelID Equals ${ChildModelID}",
        "selectSourceField" : "FieldName",
        "fieldType" : "select"
      } ]
    } ],
    "buttons" : [ {
      "label" : "Export",
      "fxn" : "var row = section.getCurrentSet().getInstance();\nvar model = row.getValue('ModelName');\nvar moduleName = row.getValue('ModelModule');\n$scope.Logger.info('Exporting...');\n$scope.$http.post('/export/' + moduleName + '/Model/' + model).success(function(data) { $scope.Logger.info(data.message) });"
    }, {
      "label" : "Test",
      "fxn" : "var row = section.getCurrentSet().getInstance();\nvar model = row.getValue('ModelName');\nvar url = \"/data/\" + model;\nwindow.open(url);"
    }, {
      "label" : "Add Fields",
      "fxn" : "var model = section.getCurrentSet().getInstance();\nvar tableName = model.getValue('ModelBasisTable');\nvar fieldSet = model.childModels.ModelFields;\n$scope.Logger.info('Finding columns...');\n$scope.PageService.readModelData('ListTableColumns', 'ColumnTableName%20Equals%20%27' + tableName + '%27').then(function(results) {\n    var modelName = model.getValue('ModelName');\n  _.forEach(results.data.rows, function(row) {\n    var newField = fieldSet.insert();\n    var basisColumn = row.data.ColumnName;\n    newField.update('ModelFieldBasisColumn', basisColumn, true);\n    newField.update('ModelFieldName', modelName + basisColumn, true);\n    $scope.Logger.info('Added ' + basisColumn);\n  });\n});"
    } ]
  } ]
}